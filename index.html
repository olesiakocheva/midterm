<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Art Stroke Generator & Classifier (tf.js)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{--b:#1f2937;--m:#6b7280;--bg:#f8fafc}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);margin:24px;color:#0f172a}
    h1{margin:0 0 8px}
    .muted{color:var(--m)}
    .row{display:flex;flex-wrap:wrap;gap:16px}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:16px}
    .col{flex:1 1 320px}
    label{font-weight:600}
    input[type="number"]{width:80px}
    input[type="range"]{width:160px}
    button{background:#2563eb;color:#fff;border:0;border-radius:10px;padding:10px 14px;cursor:pointer}
    button:disabled{opacity:.6;cursor:not-allowed}
    table{width:100%;border-collapse:collapse;font-size:14px}
    th,td{border-top:1px solid #eee;padding:8px;text-align:left}
    canvas{border:1px solid #e5e7eb;border-radius:8px;background:#fff}
    #log{white-space:pre-wrap;background:#0f172a;color:#e5e7eb;font-family:ui-monospace,Consolas,monospace;padding:10px;border-radius:8px;max-height:200px;overflow:auto}
    .pill{display:inline-block;background:#eef2ff;border:1px solid #c7d2fe;color:#3730a3;border-radius:999px;padding:2px 8px;font-size:12px}
  </style>
  <!-- libs -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.20.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <h1>Art Stroke Generator & Classifier</h1>
  <div class="muted">Классификация синтетических «мазков» в 4 стилях: <span class="pill">Impressionism</span> <span class="pill">Cubism</span> <span class="pill">Abstract</span> <span class="pill">Minimalism</span></div>

  <div class="card">
    <div class="row">
      <div class="col">
        <h3>1) Генерация датасета</h3>
        <div><label>Image size:</label> <span id="imgSizeLab">64×64</span></div>
        <div style="margin-top:6px">
          <label>Samples per class:</label>
          <input type="number" id="perClass" value="300" min="20" max="5000" step="20" />
        </div>
        <div style="margin-top:6px">
          <label>Noise:</label>
          <input type="range" id="noise" min="0" max="50" value="8" />
          <span id="noiseVal">8</span>
        </div>
        <div style="margin-top:6px">
          <label>Stroke thickness (px):</label>
          <input type="range" id="thickness" min="1" max="8" value="3" />
          <span id="thickVal">3</span>
        </div>
        <div style="margin-top:12px">
          <button id="btnGen">Сгенерировать датасет</button>
        </div>
        <div class="muted" style="margin-top:8px">Датасет будет сбалансирован: одинаковое число образцов для каждого класса</div>
      </div>

      <div class="col">
        <h3>2) Обучение</h3>
        <div>
          <label>Epochs:</label> <input type="number" id="epochs" value="15" min="1" max="100" />
          &nbsp; <label>Batch:</label> <input type="number" id="batch" value="64" min="8" max="512" step="8" />
        </div>
        <div style="margin-top:8px">
          <button id="btnBuild">Построить модель</button>
          <button id="btnTrain" disabled>Обучить</button>
          <button id="btnEval" disabled>Оценить</button>
        </div>
        <div style="margin-top:8px">
          <canvas id="trainChart" width="420" height="220"></canvas>
          <div class="muted">Loss/Accuracy по эпохам</div>
        </div>
      </div>

      <div class="col">
        <h3>3) Превью/Инференс</h3>
        <div class="row" style="gap:12px">
          <div>
            <canvas id="preview" width="128" height="128"></canvas>
            <div class="muted">Случайный сэмпл из train</div>
          </div>
          <div>
            <canvas id="draw" width="128" height="128"></canvas>
            <div style="margin-top:6px">
              <button id="clearDraw">Очистить</button>
              <button id="predictDraw" disabled>Predict</button>
            </div>
            <div class="muted">Нарисуй свой «мазок»</div>
          </div>
        </div>
        <div style="margin-top:8px">
          <table>
            <thead><tr><th>Класс</th><th>Вероятность</th></tr></thead>
            <tbody id="probs"></tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="row" style="margin-top:12px">
      <div class="col">
        <h3>Confusion Matrix (test)</h3>
        <canvas id="cmChart" width="420" height="300"></canvas>
      </div>
      <div class="col">
        <h3>Логи</h3>
        <div id="log"></div>
      </div>
      <div class="col">
        <h3>Классы</h3>
        <ul style="margin-top:0">
          <li><b>Impressionism</b> — много коротких штрихов, случайные направления</li>
          <li><b>Cubism</b> — угловатые многоугольники/плоскости</li>
          <li><b>Abstract</b> — кривые, брызги, хаотичные дуги</li>
          <li><b>Minimalism</b> — 1–2 тонкие линии, много пустого фона</li>
        </ul>
      </div>
    </div>
  </div>

  <script type="module" src="./generator.js"></script>
  <script type="module" src="./model.js"></script>
  <script type="module" src="./app.js"></script>
</body>
</html>

